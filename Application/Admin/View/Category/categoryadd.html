<!--修改样式2 p元素自适应宽度 start-->
<div class="pageContent">
  <form method="post" action="{$host_name}/category/categoryAdd" class="pageForm required-validate" enctype="multipart/form-data" onsubmit="return iframeCallback(this, dialogAjaxDone)">
    <input type="hidden" name="id" value="{$dinfo.id}">
    <input type="hidden" name="type" value="{$dinfo.type}">
    <div class="pageFormContent modal-body">
     <div class="tabsContent">
        <ul class="nav nav-tabs">
          <li class="active"><a href="#tab1" data-toggle="tab"><span>基本信息</span></a></li>
        </ul>
        <div class="tab-content">
          <div id="tab1" class="tab-pane active fade in">
		      <div class="form-group row">
		        <label class="col-xs-12 col-sm-2 control-label">
		          分类名称：
		        </label>
		        <div class="col-xs-12 col-sm-10">
		          <input type="text" class="form-control" name="name" minlength="1" maxlength="300" value="{$dinfo.name}" required>
		        </div>
		      </div>

			<if condition="$dinfo.type eq 1">
		      <div class="form-group row">
		        <label class="col-xs-12 col-sm-2 control-label">
		          所属分类：
		        </label>
		        <div class="col-xs-12 col-sm-10">
		          <select name="category_id" class="form-control bs-select" title="请选择">
		            <volist name="category" id="cinfo">
		              <option value="{$cinfo.id}" data-content='<span class="lvl">{$cinfo.html}</span>{$cinfo.name}' {$cinfo.is_select}>{$cinfo.name}</option>
		            </volist>
		          </select>
		        </div>
		      </div>
			</if>
		      
		      <div class="form-group row">
		        <label class="col-xs-12 col-sm-2 control-label">
		          显示顺序：
		        </label>
		        <div class="col-xs-12 col-sm-10">
		          <input name="sort" type="text" class="form-control digits" value="{$dinfo.sort}"/>
		        </div>
		      </div>     

		      <div class="form-group row">
		        <label class="col-xs-12 col-sm-2 control-label">
		          状态：
		        </label>
		        <div class="col-xs-12 col-sm-10">
		          <input type="hidden" name="status" value="0">
		          <input type="checkbox" value="1" class="make-switch status" name="status" data-size="small" data-on-text="启用" data-off-text="禁用" <if condition="$dinfo.status eq 1" >checked</if>>
		        </div>
		      </div>
      	  </div>
        </div>
      </div>     
    </div>
    <div class="modal-footer">
      <button class="btn btn-default close-m" type="button">取消</button>
      <button class="btn btn-primary" type="submit">保存</button>     
    </div>
  </form>
</div>
<div id="nav_html" class="hidden">
	<div class="form-group">
	  <div class="input-group">
	    <span class="input-group-btn">
	      <select name="nav_type[]" class="form-control nav-select" data-style="btn-success" data-container="body" title="选择导航位置">
	      <volist name=":C('NAV_TYPE')" id="ninfo">
	        <option value="{$ninfo.id}">{$ninfo.name}</option>
	      </volist>
	      </select>
	    </span>
	    <input type="text" name="nav_name[]" placeholder="导航名称" class="form-control">
	    <span class="input-group-btn">
	      <button class="btn btn-danger trash-nav" type="button"><span><i class="fa fa-trash"></i></span></button>
	    </span>
	  </div>
	</div>
</div>
<script>
  $(function() {
    $('[name="is_nav"]').on('switchChange.bootstrapSwitch',function() {
      if($(this).is(':checked')) {
        $('.nav-set').removeClass('hidden');
      }else {
        $('.nav-set').addClass('hidden');
      }
    })

    $('.nav-set').on('click', '.bs-select', function() {
      var selected = [];
      $('.nav-set select').each(function() {
        selected.push($(this).val());
      })
      var thisVal = $(this).find('select').val();
      setTimeout(function() {
        $(this).find('option').each(function() {
          if($.inArray($(this).val(), selected)>-1 && $(this).val() != thisVal) {
            $(this).prop('disabled', true);
            $('.nav-set select').selectpicker('refresh');
          }else {
            $(this).prop('disabled', false);
            $('.nav-set select').selectpicker('refresh');
          }
        })
      }.bind(this), 50);
    })
    $('.add-nav').click(function() {
      var selectH = $("#nav_html").html().replace('nav-select', 'bs-select');
      $(this).before(selectH)
      $('.bs-select').selectpicker('refresh');
      if($('.nav-set .form-group').length>=4) {
        $(this).addClass('hidden');
      }
    })
    $('.nav-set').on('click', '.trash-nav', function() {
    	$.get('{$host_name}/nav/navDel', {source: 'category',id: $(this).data('id')||0},function(res){
    		if(res.status==1){
    			$(this).closest('.form-group').remove();
    		    $('.add-nav').removeClass('hidden');
    		}else{
    			alertMsg.error(res.info);
    		}
    	},'json');
      
    })
  })
</script>